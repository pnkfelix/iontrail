//
// NBody adapted from Intel's nbody benchmark.
//

load(libdir + "util.js");
load(libdir + "seedrandom.js");

Array.prototype.get = function ArrayGet (i) { return this[i]; };

var NBody = {
  Constant: {
    "deltaTime": 1,     // 0.005 in their code.
    "epsSqr": 50,       // softening factor, when they compute, set to 50.
    "initialVelocity": 8 // set to 0 to turn off
  },

  init: function init(mode, numBodies) {
    var initPos = new Array(numBodies);
    var initVel = new Array(numBodies);

    // initialization of inputs
    for (var i = 0; i < numBodies; i++) {
      // [x,y,z]
      initPos[i] = [Math.floor((Math.random()) * 40000),
                    Math.floor((Math.random()) * 20000),
                    Math.floor((Math.random() - .25) * 50000)];

      // [x,y,z,x,y,z]
      initVel[i] = [(Math.random() - 0.5) * NBody.Constant.initialVelocity,
                    (Math.random() - 0.5) * NBody.Constant.initialVelocity,
                    (Math.random()) * NBody.Constant.initialVelocity + 10,

                    (Math.random() - 0.5) * NBody.Constant.initialVelocity,
                    (Math.random() - 0.5) * NBody.Constant.initialVelocity,
                    (Math.random()) * NBody.Constant.initialVelocity];
    }

    NBody.private = {};

initPos = [[22646.76606468583,16831.030730603314,-5002.503707363668],[35711.231852884615,6278.959981023673,-9978.630339434803],[16213.729830685641,11799.516358522746,22079.448560314966],[39643.54009903347,13824.126600439806,9077.061105650064],[12700.581176418797,3440.1521030558783,23622.954660667227],[20404.312287420726,18790.821704251113,-4817.800220760211],[24513.745804670223,4757.62905471263,1682.907472255801],[7712.490426729978,16323.214571332617,12912.569919886224],[32917.646016725594,3587.9705592396144,-8765.302954160657],[1905.924288953547,16907.2361982182,13057.365827635287],[34793.85630605546,19316.187419563452,4702.109572357006],[21487.856760871997,7632.326110758504,19047.39074184375],[28392.13745986612,13213.540992017204,32046.225383908277],[585.6710166136942,18474.022219956925,34030.43854055396],[10749.480682304782,19786.114484777765,2347.4025835276857],[30232.898582773883,10231.961756454424,30988.427983752736],[34228.402021061396,18929.99544049048,-7526.000688171269],[34697.82576601575,14366.303878714478,4568.842652473604],[4686.311501818971,1888.6869549456696,33770.02879641703],[8108.624966562069,17294.220423500334,-9609.121123098834],[37099.919889735495,18284.730248333333,-2125.663551699917],[16027.743762305838,15071.704274185922,28954.118172965995],[30533.029444748718,4330.652425747729,31896.231756095738],[19935.272589419445,4145.16314726499,7092.682562234017],[20123.558369883012,19164.17010019892,-9271.588426609605],[1158.2888423259662,7088.8544824657665,19093.151628053176],[33498.61330609642,16633.707979529485,15471.573615888225],[32552.42737188407,10545.561209905978,29397.27865676798],[18630.411125995513,10821.575264007633,19124.471044055066],[27529.04156170653,14274.730777600364,-9612.323043611883],[15023.438117899379,19644.37533097886,-691.619154685702],[1247.392982901742,1135.749695464609,35161.753060467585],[11763.788008324513,3569.7891263765164,15802.795197770945],[2562.9555022788245,18004.953231030646,25659.735643686723],[19844.908950307785,1567.3219496537743,15949.919172851152],[15071.859802239622,9745.579895740848,30119.466285777286],[16955.337034266784,11314.864143502538,-6243.225816875752],[7544.924661851513,19876.877194202923,31584.221671315983],[37024.91463311593,14166.839043294915,13533.262386942191],[22978.982784890428,19859.84103882901,-4960.953514072574],[154.68025883692724,15597.054781806488,1574.9741025592089],[24214.457361432538,11894.038054855822,-2567.4054933757266],[21895.999250108962,11525.635764441162,18257.661420094973],[23933.4315346725,17831.13221058546,32740.033088683213],[16700.43587872936,10185.037461615691,-8621.837603597787],[19476.619432188334,7810.4654528934825,8368.27737382462],[6518.569533710167,19775.24934665093,1836.1649763427179],[37577.82367728734,1344.3100909089833,-7598.450150072557],[36181.168702115894,18688.560999966066,4928.001343246943],[9871.78704252975,10953.336126619202,34089.644219391725],[29213.18173441987,16429.140400188662,21634.323632976077],[17807.187850054204,1197.191054412476,4101.836548860987],[2082.7597343984726,3443.671588332198,-3076.913475074458],[14920.356881952006,159.75642523692684,3684.0461190639508],[9240.37143427618,2498.182569164948,36810.07223050864],[19627.380668466652,10604.19972108148,23052.067371033474],[4534.642214740314,9793.858057237097,26985.20792506222],[24306.545313672315,1328.3063466466174,16955.764342521823],[33211.59696492872,3854.289286705462,18767.250644348962],[38083.59234379797,13538.173261830789,26005.010066750805],[19510.162783639254,13231.100042431362,34655.54522881744],[33769.85546129613,5466.370086786508,12521.712244633032],[8095.17785955865,8928.3791862755,20557.674025479377],[31096.741796929677,9437.616408940885,26186.33669004575],[33518.07035084593,19150.042944373832,12604.942013772681],[14496.167293545153,11800.431783779699,14730.985608297464],[36876.64449605204,19573.76706215589,21100.184527454476],[13983.907048963873,16785.895520737588,-9030.469240488655],[3211.119655624784,6767.5601575286755,18831.64205369267],[4641.630895889797,17431.528443909672,30428.508770931887],[27851.41451529,4770.160678773686,814.4558760538056],[17562.162571334422,14054.997266611108,27714.413326716796],[37904.041452861464,14888.13851336517,-3089.187369237455],[23326.18357909653,12737.310583461085,26497.277499429263],[2157.9690529063164,17461.730731506148,22500.926619881935],[5902.951231013061,9925.154975087968,25324.919428716774],[1564.1932471765508,5081.883969684888,8883.402615745315],[29517.563768642107,8072.507828107023,30270.42381789329],[24993.180806989832,2381.3535275514378,10632.893378961237],[33928.79814225023,1730.460438131119,22728.768567497755],[6892.656790277514,8159.7348707985475,8165.103605290671],[27432.13864822473,17516.913213681877,30997.522339918978],[4880.20817478483,16500.306661462382,6270.762419666019],[32793.97934390062,14994.37961173594,-3334.942007191336],[31272.259466155498,18991.56206151232,-4409.062102947876],[31336.339936403394,15049.93655128353,32681.905440951177],[5960.53911651971,16697.70294691492,34585.40703704756],[27599.888321773968,1244.0055867264653,-9681.729780368792],[27643.603076447085,18209.39469122886,7674.114030788379],[11266.042158230683,12831.966513784135,-9393.72124478693],[3654.5974717868594,1003.4996334874606,35075.216461266544],[13290.545140577175,4254.74415758636,6024.107080884634],[34898.94506535282,9269.350531648633,17380.0624294544],[33458.62761531885,3447.4007262356963,12811.970410197802],[32621.73888753419,4255.983561402357,34811.051670469205],[9631.221453134267,7993.159851166452,35963.86120322017],[20423.82989997938,110.79193791580299,16711.35390834461],[14004.980972118157,10783.419454074461,20646.880616695675],[32769.29934313168,12759.847405250039,3276.806788689182],[23281.83515570768,18075.24156609764,16110.169127394836],[14163.738258450368,13786.05208681269,20032.42875494908],[35515.189676253685,13496.002965975526,-11122.285892426733],[23551.158750581664,11977.691179791891,3676.878907741841],[39513.27393538786,15549.847174620932,30171.58874768304],[39323.95975180289,12907.39892492344,21479.53168938869],[7436.227422409262,15082.853776250562,30745.364359272447],[13990.17493486056,3409.6446415330015,18540.916356787722],[3430.4344318398375,2081.730654811058,24533.53298323215],[5397.333960531951,2046.9403434448209,-5394.329592641423],[14077.449720272338,18288.054986387535,17598.583802802106],[30169.62106289718,12130.429531667556,32867.93646226905],[3607.0664806840996,6261.660900974034,35782.467855098774],[18702.709980745094,17731.40140444618,31214.164147193744],[31893.318482085568,7229.617388450637,-11897.937658289728],[16502.91303067535,9885.769297421219,18414.76948331838],[14498.879349938468,4967.006369145992,4957.378354603323],[1524.3249624639436,14725.237383801576,-10666.778868067013],[7571.0167262149325,15057.197546443937,19144.27607704692],[29062.400076025446,14719.931356631661,33037.04610212286],[6969.029632408973,6966.167656201859,-7826.645596823711],[26857.847259110928,5714.58271241273,25829.302276673487],[24447.346788651135,2311.1516673991937,33426.590519229416],[5941.155358554104,10800.435104735006,-3137.4257526378096],[26545.607283563117,16030.834704694304,17856.966732740428],[18307.521660532984,15667.750785545803,1572.2304249995134],[18806.63804585652,19438.35441916483,1157.160774206907],[22672.828516746864,15471.38128502661,8361.63916070227],[34655.54777705259,6371.996284451147,21064.32194561613],[31434.340642797397,5463.309832401941,5750.79612186571],[5260.014577147366,475.90518323340063,-10051.996401093991],[16556.073390952602,7734.119743816654,10538.112565604986],[7080.4873312284035,14032.69838219974,157.3628983506389],[33607.037407325726,8091.00611926784,32930.40353799708],[22007.102572894863,389.85518006049665,16107.649555927144],[10888.565151455172,13447.524402126264,2.352767589125129],[37118.6436741574,2834.388012310596,23925.809293990118],[29961.908533016875,18837.702008269534,10059.721264775373],[39085.88737698044,18203.159213979725,-6454.858416375491],[8757.649884581095,5942.438726157146,-11263.35373266426],[21711.534880504576,6335.338375058242,-5877.4685861068265],[5240.449440287812,2860.883222145166,17167.318321961986],[16862.83925274711,5352.095962551173,36480.22950614976],[34411.190262173826,15394.630891369852,-2969.532993966431],[7849.716959973689,1262.8214975389878,5520.360362559409],[18900.811275398824,3822.440913020585,-6588.505520562105],[26519.80254620347,16375.656926400161,19650.69997620799],[11982.69994059537,462.4410991016233,17048.938471966972],[27421.95138369856,9638.154344969138,17536.812111252406],[38363.56860211654,3686.981168554566,174.54778682344931],[12287.944009786806,382.6838754400727,27106.867251602398],[35607.27561196059,17143.989324520935,21716.23429669098],[24665.953208827454,9317.110814478348,12634.682306517541],[10706.530578307073,10519.40036131538,11002.99046022561],[35516.84408968761,6189.052379671661,34028.20922749081],[34805.58995532291,13363.772814038131,2477.5091517586984],[34143.24002311453,11869.113339814558,31774.376595832222],[4536.067723043134,17612.026666008423,29035.92576257498],[3983.762705549014,3568.6928379231585,-10741.756930719675],[26059.488476253224,10369.069681070001,28894.43173365523],[14767.61124006803,19196.666915448004,29708.624052725787],[39049.66365290058,8703.919916499925,37097.22537237987],[11162.987068088765,9588.100458194067,-2257.235807569795],[3507.187629274224,6691.226921294012,2696.589736422755],[39305.01960592256,5600.484185885103,-3903.6158134279244],[33067.41159493606,12259.11141118972,-11051.008342998128],[11064.80560170316,10151.6347503624,16218.378322434857],[12896.682475283698,16202.98327784282,13412.94449906572],[23039.304163791807,14352.003164321834,12282.13919683537],[33589.46226564177,13911.359384859958,22848.880653684373],[20488.48980820943,806.6165244824812,15777.465563942536],[8987.84082519558,18113.39435927646,29361.117297541732],[30434.969353003522,2631.625471197054,26244.214559521704],[8570.72642237107,13249.521151492925,-877.2610059810864],[30811.247930656496,4501.336117035573,18107.228912469825],[39909.5797996422,12632.79910234566,-5330.399433502786],[35667.999622127565,6173.479572839309,5570.506687752428],[15582.538493861543,1316.7347087251885,12100.550480193526],[37328.660525317835,10874.044697673444,17554.5679850512],[31279.076439548764,12055.212969043923,27245.516147406546],[29873.14314929906,12565.212302514605,-6759.204870301655],[34897.64674585748,11179.304577767452,36670.219516681136],[17276.841947899327,16729.690749452173,-2931.7060886536224],[11215.757552158782,4295.336254074274,-4321.991100127592],[5393.979550884837,15273.253156541226,-7870.889979301337],[39407.43521174363,2270.631745925919,19472.850570230064],[14007.64978833657,12687.550628422254,23441.661337646266],[29152.98837233588,17884.95837415716,35359.51475079175],[3930.300369044016,13055.160485223594,11422.604623843336],[29193.42904758522,12040.940655382767,23877.210687208913],[32487.980023089,2512.3856095613833,377.1183344048668],[19662.92128339569,6651.52107855212,35053.94081839795],[23220.63320795545,1981.1562138837448,36720.30370700944],[16510.73074642031,19873.283091057598,-4137.877511053716],[31603.90395642631,3747.682017983396,34529.20196136435],[20257.983759905645,6468.005314298363,23459.17542563798],[26123.388194385498,8512.141856023067,-7902.138569682717],[37617.24758336134,5320.871016625976,15273.671332475442],[1110.7673681446684,1014.9797251358966,25553.86966989545],[13036.4144765117,3364.790548085189,11488.176894350014],[32639.282972525296,13888.986325197127,22284.400334965343],[35676.54275656735,14604.046510623786,-11368.553119121183],[34173.21645722368,9404.895445598997,5213.392981088647],[7814.003516737789,12151.670033975903,11509.29407596807],[3883.4528005944985,9050.127831567876,12239.762012364383],[35300.03607506517,2100.283964479211,12559.468060456224],[28352.9487648661,18381.563094139383,3917.9865644673237],[35417.22587094182,2842.8390083526992,24514.974887329936],[29717.746383100548,19996.749479250877,-9172.49809776137],[18020.19718673469,5881.622843194975,30481.87409983684],[39220.71175919288,1658.415045042816,6738.37592866373],[35467.79252423224,4783.6812074367,-1527.0029406374651],[23021.53666944502,9490.457064581293,23154.39815270853],[16087.099612725398,10352.491231085094,37077.46871988659],[37840.90443092528,2539.5262302344927,26335.568622620485],[7529.094205277665,11699.833994163155,719.9888424087999],[11474.81767060191,866.8036720109609,13796.906653832748],[29898.614780560565,76.11846685701772,7308.042751659215],[28218.37138599677,19380.335065146024,5536.015356188993],[20626.254612433273,2535.967900022878,31008.261595968906],[25074.2579157571,11332.286561686693,27703.70720264236],[4331.648625632034,1630.637378995119,-10498.846026134126],[33241.56555589574,14769.498409351396,36142.73809343215],[18682.872464968863,16621.21872680161,1580.3364356181562],[21789.45224411919,6196.1292449298035,13258.147212764914],[10535.251117980188,13809.307894415171,15885.22243217526],[24513.97811458313,14734.97036276265,3997.122359201716],[29460.11607284151,13628.963037457968,25898.562313240982],[39815.76196368699,18981.438851337927,18314.44767430285],[22049.57998846475,15066.915808035103,9378.425313686997],[15437.452388753924,394.9858971485556,35196.99416281822],[11767.376155377618,1539.0505512132445,30648.880241808594],[36888.24998039498,6019.638375429316,20006.80177704547],[36819.08015152925,8302.756048856723,35275.20937461752],[6249.47506483554,7411.818514922066,13622.555876526523],[29806.681137541105,8941.86283350541,14617.525755413868],[14872.182060710911,3431.902112552515,34115.04293433543],[23614.100173321225,7289.964714973979,11757.763215177587],[21742.971572448325,6482.084056908975,5425.395919691539],[31081.57340212852,4199.160570567427,5428.86394196797],[26243.628627759757,925.1948135569382,3242.448518939958],[266.15400320587503,12810.214450682854,30169.28645738867],[35715.72406969551,16094.2444206947,-3751.0370272737423],[39392.000018435974,17531.4488114635,27815.792802609452],[7715.324714931036,14231.123397795158,-4206.912102809816],[30242.00020223433,1411.8674593109592,13123.629010320623],[8532.314177666754,17360.874264160055,6126.069011001629],[20752.27761916919,15112.101355268236,37009.66091989072],[30382.37921554846,3963.9480986786507,-2199.4482036861073],[37485.964735518115,2837.6273204279782,27801.88663286654],[15562.403108303017,1775.9812670101032,8415.446566007067],[2199.811329955123,5489.821972159024,-5089.014008458884],[22606.80391871867,17418.393432420882,8620.627819534637],[13457.325573349539,13442.159005055855,-2681.4995732222037],[4581.62575208872,4687.857465864125,9593.85409229408],[23383.33166796581,16471.40087279589,-6116.474434960874],[39690.71408980432,9578.897287950233,27086.342777767088],[9082.87824849386,10175.431669062375,-3478.971147572002],[13097.705455128016,5099.03721721757,17364.949775984052],[18330.948084297343,952.2275400378892,-6499.271738696964],[3371.570411850393,8828.773405836007,13784.34480763094],[19802.0657288437,9307.52925995895,33465.24484548112],[26930.753118977027,7070.390313008499,17668.293797060694],[9166.917877811751,11642.36103317832,12775.7119525986],[37321.71847719338,13322.876563711467,10728.415888112324],[18428.34275162093,11303.74186100293,-3834.1753336420147],[5189.829972221109,10789.05046944734,-10247.317868977589],[35388.78865895881,17613.62904193814,23432.512274267912],[19152.669639127776,9984.661595200341,24606.111869283395],[34211.51256405956,12582.278917503847,30013.80954492944],[20080.67487110735,12304.555262208416,34916.643552020985],[36816.51276278587,7806.941010980003,19317.678125034647],[35927.956141150746,17926.03533827471,-8908.936741821602],[9253.329002981338,18455.99277379385,31751.880558556684],[20329.31934974457,13132.513691588654,6028.054176389749],[21443.509067305502,11375.500695050596,15327.731707129653],[22875.29849518161,3785.2352564033777,11085.51571706449],[34534.89430375161,9833.07870827878,24402.91898484408],[23790.791336692062,10415.908484308786,-8407.957044879597],[38377.01475952366,2396.054830189217,-854.5511383990338],[9708.204773718253,1122.5305587595979,8844.294724136578],[25774.587758239002,16258.502501904804,24655.744041983875],[28615.9506010793,19603.362691469465,16060.882917843026],[7656.988963349596,4939.6317342910215,948.6755393464086],[32026.00292779043,12374.109327428341,19169.518733683042],[22562.375108850996,12988.551777162253,-1332.3158628216536],[28973.219074913257,5522.581424379502,8651.071795273625],[29735.157578212955,825.4809212798554,-9235.635148480314],[21931.771588312244,15472.510499889431,26198.66937361492],[1647.2754302037447,10937.783357734512,20442.19475782226],[19525.849311489677,15117.677913114961,-2792.380388385147],[34412.733249737816,4426.250429844512,26507.29696686555],[33560.944966109404,10304.570769825263,-8113.937601167667],[500.09451174079805,10597.265120898084,27651.022856718464],[18249.148640119056,5721.02615085656,1869.0466065870946],[30550.410680993664,1868.7031223723857,20660.8704456344],[15931.731439609272,3294.8329784094285,35416.677727363625],[20861.64527676888,5330.69408356399,34216.222833723856],[31023.154809767486,1334.363165998396,35443.73097733812],[17675.326520187158,8638.001099524787,16401.088286819104],[25354.54782649854,15902.998628744688,2919.7550013292666]];

initVel = [[-0.029549266272005187,3.548754305001611,11.492433533212397,0.3401116790208354,-3.8124016020653073,5.695725977374667],[1.0566555515138238,-3.6259830376068143,16.217876352387968,-0.771408920094323,-3.0638334066280426,3.4598735381857164],[1.2401702643456451,-2.3242198063844977,13.210890844771633,-3.43362414338217,1.5240536846073507,1.191876543422607],[1.2917115528737804,0.7011545740871488,17.121600707806383,-1.6966928041445155,-2.776174019639197,7.14832834251795],[2.546788710630597,-2.4936519046194805,14.15185080918491,-0.06945977632913314,-3.538746834463955,7.4166723486175545],[-0.25055007926901907,-2.0867938356229705,16.865970843157097,1.8306758420263973,-3.3206158682275917,6.2180302116493715],[-1.9910692696226089,0.14361219698333644,15.668634435573438,-0.0677266679036097,-3.6264032215558863,6.730608324838784],[3.4733432266479993,1.1134321328088408,11.446269380288799,2.37953206349822,-1.291966628527141,7.8235232524023255],[-4.323535182678039,-0.3285854300079271,14.6693997360637,2.144147376118937,1.2108182411930954,6.750998355935302],[-0.003928439064223674,1.6090162951564175,16.932754551101528,-3.3820741433686075,-0.7823381381494752,4.42740023906186],[-3.994244957550661,0.4046091719838325,13.641739169245655,-0.6538503431604843,-0.5591073372654232,7.61825706411967],[0.44812648920657544,-0.5167234405982258,16.006917643821023,-1.744491020305876,3.8863109716640727,1.9848683045613478],[-2.9347909012877444,-1.047777087084865,10.950474653239283,0.2029417067125321,3.762689267511516,7.539809874003487],[3.5173533263990784,-1.4352371160763207,15.443430952153134,3.218949182117834,-3.3064455723145443,5.486930097150372],[3.025680212966606,-0.1723156652480956,13.356177712335306,2.468010933574881,0.5068952168578189,5.181620324892107],[1.0337176557512051,-3.3243308547839963,11.973836642157625,-2.196948805685974,0.7570196156251949,2.455617884396031],[-2.9332779394044963,0.5190236716467674,16.047900494685816,2.131747452629649,1.6493152754932794,4.4950142695786734],[-3.2999708726576693,0.9726096029543593,15.505322147407854,-0.9320130187909603,2.4212410327875977,0.11576305623107618],[1.1992046160548617,1.2882866932751582,13.228205951656047,-2.380000596003593,-3.042739832206043,7.003598845469617],[2.819692578940162,1.8211021363244067,10.474795939758721,2.667420919118965,1.9303232086030535,3.908198609064114],[2.958134195448494,-2.387271104810125,10.306409285293032,3.7732002225556522,2.866491958306625,5.122995823554584],[3.378541336378211,-0.675600221352985,12.717577731188069,-1.334176443790232,0.0874589015986027,6.885190758457662],[-3.499985727736806,1.2429106199097835,17.726035433246984,-3.293989035355712,2.941448602124762,5.311816924074207],[-1.9924477918714094,-1.2934207206205202,11.033229526416363,1.656484572941043,0.16882794070624296,2.2738699860021616],[-0.3051418849488178,1.5837919711655344,14.68659755076921,0.14289902033893576,0.673672172931596,7.892716396188958],[2.794820107496697,-1.5484694957184644,14.90487065477457,3.7277749689449413,-2.3796924966347577,5.102514498908032],[-0.5469825544033654,-2.2569778154684546,11.343628917064628,1.9045969106961023,2.500008547441092,0.6616844926123884],[-1.5429829120201404,-0.7134839077031349,14.310471097643953,2.9728448694062193,0.06902907825011617,7.353724486854191],[2.159333407133788,-1.0655046804582973,16.18040448660622,-2.8284460801889217,2.2459850215153168,4.125818846017827],[3.1558056497188236,1.9991363232230661,14.660047521048085,0.8996744582499385,-3.750888010599189,6.740052820631649],[-1.5625965573414926,0.26945948914968576,10.878922028372765,3.4305050533136203,-1.7063280850345115,1.1790818672535999],[-0.7966491223273551,1.9846252584142263,11.231358920547647,3.5529983542544796,-2.3843706967979648,7.651190443981148],[3.358997773396198,0.13828357236730243,14.98830638166001,1.1771365200258552,0.28533933184901183,6.798666414171076],[-0.18917397921228132,-3.068226056196681,13.834929280997201,3.3971078948144102,-3.3785844395400257,4.708467415002347],[1.680268780413137,0.116922681285247,16.776609828500717,3.976348940594537,3.9677640578021363,7.9815571650552055],[3.1888917032760027,-3.0310018167959085,10.852134444870709,-2.0840400104092245,-0.7450842358163179,0.8631220439380586],[-3.7244785341101387,-2.4086772488209123,11.426830222812832,1.3646471653665264,-2.2083189355832022,6.961836899236874],[1.338749768692589,-1.4543615926523343,11.43988220342539,-3.532773416003395,1.757476870418805,2.0721927880004274],[-1.94876509607926,-0.9818238303474772,14.508066133515472,0.3659530735938734,3.689285122516649,0.4650727525188654],[-3.1231650531931,0.3255430501087083,13.885167134073091,-0.3732878396174941,-0.4225919808779852,5.316466114474865],[3.8895674259899575,-3.239798599089608,16.018815265018297,-0.3682041797918383,-0.47996630879028324,6.058514801375957],[-2.3748145295901693,3.4831675056059583,14.40748197481696,3.6736712577419963,-3.4242310161075373,3.583600923901386],[1.4859159522480159,2.556855192750062,17.741663180731862,1.7190722864597596,-1.162167767998795,0.5723016546561487],[-4.006425114724271,-3.8037057900753486,15.755035236247863,0.4596084812768364,3.742631408635753,3.448971579429617],[-3.7567029778117376,3.457378700730437,15.970095487527972,-0.22055888087774944,-3.4429911508798727,0.7820410329976216],[-0.22842412434632656,3.6262073222755764,15.175603652786839,-3.266225636205074,-1.0219092224508537,6.631212891482995],[1.9616262390472679,0.5028201909151687,10.817394768155491,-0.6781711097939769,0.6397955623390414,7.757678693596822],[-0.8738057794899865,-0.5211309005828079,16.651843791088886,1.0092344556270314,2.830254594739726,6.822148664439116],[-2.381275244374755,1.8825743136505313,11.654330065321291,3.8061887418422424,-0.7751217263830696,6.68578194038583],[-3.397037807965871,-1.1845095902623328,14.373785171009468,0.8199468541198485,-0.7700164238288867,5.818074183576522],[3.190751882553151,-3.963791543936199,15.357893115397378,-1.166050870480213,3.0781170938167657,6.84654774429881],[-0.6835797325792223,2.5724633238376144,13.900420023122892,0.5176007930343012,-0.012931311644220678,3.534978931958207],[0.9358904817970464,1.1408527964077309,16.610022852525976,-3.6989465442979648,3.922474461202004,5.44017732193218],[1.8263016167436072,-1.907129848914138,11.236067147354701,-3.55718065041835,0.2104071523273081,1.2673768043071427],[-3.5001624131902362,-2.7560646834449196,16.82238072525526,3.917334761236985,3.668524671885163,0.5674935632997979],[-1.0269122743466297,-2.2772267131052306,13.196696919044372,-2.5105130147534496,1.2111661253135733,4.861673166154113],[-1.136735975097285,-4.070617555734301,12.15405841364728,0.13031149884662252,1.0948438827114648,0.3208229067608665],[3.374218393447406,0.5923374230177795,10.353471184288031,-0.14012183633575592,2.4472535606555814,7.6236108794783215],[1.2800389809879527,-2.4114958300340734,17.08793105617862,-2.7507250747035004,3.9683724460549223,1.595728373042347],[-1.0091362362214182,2.4425745253635256,11.82474763287033,-1.057840659368729,2.932619405716933,0.9709678303832037],[2.408424239828049,2.647315518882832,16.396439884664506,-1.0104708359290395,0.6849747765015817,2.3602643833082855],[-3.143680437902552,1.3349109176917884,17.461259087745656,2.2116257067186424,0.18733251548312868,4.197229205293408],[1.8211818859737179,-3.515824602243887,13.817372603307353,-1.121914329655198,1.3953968981598317,0.22234916213436945],[-1.935975874306558,-3.4804531858589294,12.560715448811207,-0.5703619394028046,0.27167741556020175,4.56677643210486],[-4.043292740640953,-2.7459254853205657,10.039564658872122,-1.8207649829113914,-1.6395465311372623,7.653642704390323],[-2.3607116870742564,-1.2627830375617157,15.60866143202425,-0.23096428427557347,-2.8490324887514653,4.782130810682147],[-1.466848597538508,0.24646608990896546,14.98619830976529,-2.042245903857002,1.4779474416605662,4.0197677820015905],[-1.5262691511417024,-3.9755767435527973,12.327915266870079,1.2290151984814806,0.7644342227646908,5.957035945445954],[3.098124282878711,-0.5218766427011372,14.352504446651924,-2.8562744488151774,0.2882006506835806,4.297451175119828],[1.4470386342108879,0.002823788709419156,11.33472029885952,-2.2944338555720876,0.8809040425593713,7.333858222404914],[-3.581509937770273,-1.4957698305878844,17.630206723694325,-1.9915521240579017,2.9641177339484583,1.9082521755641937],[1.0713321206031918,1.3135694686214479,10.864322738481912,3.6634030663931716,3.4234182561187163,1.877146573755799],[-1.7067219631335033,2.8275815431382414,16.805585220624,-0.4444516472203657,1.3554365840454503,5.877410744676749],[2.0128064467807705,3.3074080341723597,13.734111106090523,0.12727445891690614,0.7442620130039748,5.2927507865828085],[2.5782452983754856,3.3408573950240394,15.11341634112339,-3.3401496552021794,3.1528334440003922,5.38285614608919],[-0.09221179961598264,-0.7807489198869071,11.414688918438397,-1.462382823204658,3.240864517251164,3.7177536635119877],[-1.8175723513494026,-0.8302487344061003,16.051196952410866,-1.2630555406719686,-3.1506385856898143,6.57864276094104],[2.5175890380122117,0.7486040907149077,16.74312837151235,-2.0436578877580667,-0.4553525780948644,1.2282460414977616],[-3.0022641155350804,-1.9994017988765425,14.011882515256868,-0.8108372727617255,-2.1574092586015574,0.6662392780809006],[-1.5500200474335148,-1.5304555150149861,17.36326706649815,-2.6910433588653677,0.24808854551347004,6.631724424397352],[-0.12727508814545152,-1.8440138950607818,11.992774510557103,2.7561417855095316,0.43596904643911305,6.593879044238019],[-2.2755934750494196,-0.5113051208507443,15.04833989479112,2.8554703343258785,-1.859748411844326,2.9824707386093148],[-0.11468206658123792,0.12221202948843685,16.82571617636712,-2.078673320998729,1.7168200425682052,7.538814671211895],[3.615930793468627,0.3872576657893062,15.562337198028716,1.4043280469151522,3.306908810488813,5.007048097175815],[-3.2716655234410195,2.302037634481574,14.464756558682758,-3.137283413943508,-0.3408703333960772,1.461742623691541],[3.3631518247264904,-2.7284520624631132,15.28912367913839,-0.5950644008955863,-0.6096261003546455,6.530236884663087],[2.144094914546162,-2.730255199214139,14.711288261357872,2.9518738870952923,-1.4579431443528033,7.769862641675431],[1.328304612861888,-1.618575489422812,17.375627904019883,-0.32938511900368184,-3.1141205720859277,3.6517868057245644],[-2.120805376068392,3.324993105617636,16.34294014727428,-0.16573303373473447,-3.7292257238388653,3.3464300904295987],[-3.9685034957841028,1.9247627254031976,17.596267948735996,2.721313414765917,2.6104355869565374,6.8266235424724755],[3.8882010684517265,-3.34352875191635,9.801530531386884,2.1552515350456307,-2.08859725159101,2.985948015371312],[-1.985264013759569,3.165843123769008,17.028187329803167,-3.479289169766137,-0.14552594390629503,2.567935983306775],[2.5551558851632112,-3.1957556146645674,16.88072665974273,-3.6485258673893384,-1.8102686066927829,5.967933865786339],[-3.697291439943276,-0.47374964355462634,12.74437995881373,-3.2275362419099474,3.3485859303176735,0.8544167584083221],[0.3823407152513839,1.435735822169207,11.34976192399653,-1.769277976711181,-1.0334766441584824,5.02896213829916],[3.850470970648677,-2.5045515390599276,10.359754254889705,-1.6542621391703465,-3.526554018056438,3.7037532113207567],[-1.6983585774888803,0.8514162788162636,14.980580550540974,0.1356525191376452,3.9521777148666564,4.470949765290531],[-1.7857653743566337,1.0078822636033915,9.945483469682726,-2.0898692368585285,1.9040859892700626,5.715014895172324],[-4.100116549532974,-3.9407327314127194,14.086381342216752,-0.466091959605925,-2.769877106246345,0.7068557897146008],[1.412817864162803,-3.897964893081687,15.136359772312987,2.7220665395388792,3.626901563494224,6.183444438009141],[-1.4613893460608707,-2.9555129560447932,15.533179578960821,-3.1479473643203177,1.6512293895690497,2.0163604276811067],[-2.2034514801206484,2.6521207562044213,13.953623032643275,-2.0231587216345623,2.2410990807517406,1.5183712439083885],[2.855812958657647,3.3259636642461885,17.68563654103562,1.551569351001457,0.5947536199116259,3.780985503426646],[3.4916066999568733,1.5021296849716173,17.358530256587436,-2.907525962214729,-1.3392389579320114,6.7274722250484915],[2.2243124742904175,2.5081070058589825,16.888645867014226,0.005354452013128785,-3.616645433405213,7.250617681902779],[0.8993576198875743,-0.3357102542808816,16.936885779565458,-0.11700785980187867,3.359989786231843,4.010619534657123],[-3.6770500242936626,3.5592181681312907,14.323359511303254,-0.05485482702848277,-3.7289781253293532,4.076994602672929],[1.1024665445708826,-3.9270509338772217,10.762311620661649,0.9746362010788001,1.22695143158795,6.281518759318633],[2.1363829655778397,1.3123114561320603,11.9605282371536,-1.7737365163370047,-3.614928657549962,5.976649613269241],[0.48842749625609444,0.6292880003131918,13.34450388174502,2.9408675702490115,-1.7251047208791799,0.7217067767110541],[1.0089279615503441,-0.9597006511167526,15.30949457645161,-3.0906089263219987,1.397346140084541,1.5420643245616275],[-0.7162746546194304,-3.5527071047233365,13.67764941352048,2.813916235774662,-0.3358251109779835,5.233084127405171],[-3.6428680487414606,0.04010297607698285,10.896561422549084,1.6646498766824367,0.9620855255747918,2.5347972747525307],[2.6347947845361155,2.033540684544086,12.631787904156154,-0.7443396444342549,1.7775624719845355,6.507049150748287],[2.346160324803103,-0.002145786980346398,15.720422103280802,3.102551319129133,-2.289672141779454,3.523376834598581],[2.232981435086272,3.8226847504691053,14.765310520352077,-2.4238029198638325,0.3879642139770132,3.1486851248574355],[2.773926640133641,-1.9490541694619221,11.472955071985355,1.2026191191196514,-0.8400071734396453,1.1897515698643344],[-2.1668728004332256,1.5633325951995731,11.550388780721704,0.9570628312665388,3.1288476142356467,0.6256587111663549],[-0.03276339197250411,-1.6653406922525673,14.741714819998759,0.9712466360269367,3.456634873764332,5.420351969525089],[-2.027311651787736,-1.1373234702804171,16.327748967442197,0.1781974719480761,-2.0924278671432415,4.4929119605841175],[-2.684112858220709,2.69315175524028,14.441006740867168,2.6215669534511497,-3.0593115956787154,2.97934009613693],[0.5534216822125105,-0.7205641908603878,11.794877485239807,-2.424408070642219,-2.2836241438205622,0.226745157126966],[2.153282389678193,2.2234459797088553,10.961478206572746,2.78018096665057,3.714942123362471,5.107877155023634],[-0.5431406846423361,-1.1359796412160568,14.952376693182579,2.391263200639366,0.06739438505300477,0.10595874782449699],[-4.0911901637081804,1.8250454187921423,16.292332693158336,1.8961499203303438,-1.8825342442730282,6.192663339510743],[-0.1757180846485131,2.2754825805305066,15.484028765870297,2.2364862189914287,-3.7108653918390235,3.4136144765557717],[-4.3189096679064125,-2.662813694287502,11.83166375487743,0.019808403152809184,2.7881052603667955,1.5892621874232191],[-2.328746835996924,-0.6917171224450485,15.80350352060291,2.159220105991415,0.35013484247497484,0.7833418189534265],[-2.5510356811827015,1.3463232872697004,12.672456188982217,1.072181055039385,-0.7672243894114366,0.3204078382724473],[-2.162459620643036,-1.159292315633801,13.22283442704954,-0.4658922306342905,2.38907445179796,7.001048410918649],[-0.6632511368962373,0.8349259207680838,17.51496409598559,0.5560403449862541,-1.6350152567173915,5.586627138845031],[-2.8360523298055806,0.9161379423708124,13.498326147475685,2.111885685502938,2.7977594077945485,4.816814258138058],[-0.40773380562505174,3.3862536188708074,16.33630879838813,-0.20233344694951105,-0.0714688148024809,1.3287528403860023],[-0.6996913956510435,-0.9908452943346092,11.84761300341857,-1.494747291048078,-2.9189339591074654,7.178834556437925],[-4.119362859018422,-2.3901625763643106,15.066055926669083,-0.674764038569613,1.5435221248963797,2.3872080132440776],[-2.827840441964692,0.5054418185749168,10.54323023222965,-2.3899659629236285,1.3265050325461925,2.287978061021928],[-1.5237424755613462,0.4539756311606472,10.110717684100278,3.7779225712310396,-1.2592247095209066,5.324280193153007],[0.5335300565771678,1.7347868889543914,15.96039112083596,0.8646493437420864,-2.7320689239863736,6.847598298154643],[1.4805206508139601,-3.04873177478104,12.088796222215153,1.86990598151022,-2.677028364711389,0.0766069919354795],[3.198467782969599,1.9522530732346883,16.692897943372493,-2.78374985185398,-0.1520253857007794,6.860690060288772],[3.163907641225321,0.2788150072734567,12.663974017016978,-2.4164634766101734,3.3743283744847634,3.2651282066274163],[1.984448686665594,3.0658337393466955,14.712448078029697,2.7142913587910398,2.0527137147134384,5.355452960468799],[0.9003682004363254,3.009057275195176,17.076749557546798,2.084186650900058,-0.6983687728862775,1.8205733197123684],[0.6797984658072098,-1.4403202122551766,14.006838952796848,-2.905194783845287,-0.8323449420913409,2.948321181272371],[1.1441485776757034,0.3596710758667524,17.275833869662826,1.5236039857402446,3.181033897598472,1.4451856915577932],[-2.5827846197330118,-0.7646492052733306,14.111895935398122,0.24797688683661612,1.5272802378623345,1.909085545276311],[1.793492617847539,0.6262777807898966,16.926153780907136,1.1510463548641452,-0.09397969891241198,6.673521782448389],[-3.312653600501936,-3.072073703626671,11.000540090759854,1.9664127401370353,-3.5751477484832055,5.2344912197204385],[-0.11729979275247501,1.569420793580491,10.597730812438959,2.8975235209317622,-2.898372497203342,7.823996705691062],[2.525134771997439,-1.7035313147530433,12.011190741597117,-3.7904000216763016,0.4540274929335846,6.833510091031373],[-3.605624548422379,-3.4717973058487646,15.167846490355313,-3.995943998070614,-0.862570318272136,2.184691629017511],[-2.6216195630942978,1.246759102237811,17.308134259106755,0.6668000188711787,2.2728727062295997,6.081475828201265],[1.2601771392896572,0.7126528888146748,15.344106696221859,-0.29228901148862096,2.656452720449577,4.003675670892395],[-3.0988981794395314,2.5943681093909214,16.000429788275135,-0.7940391077285991,0.10101333268963497,5.589293125210604],[-0.7776912033410859,0.4527020247802783,16.705800095644538,-0.2883573973379243,1.160519414985143,2.968068783270501],[3.1385336004500872,0.7442401752983654,10.688454203073695,-1.7559396500269986,-3.7452126893159656,6.686197472311232],[-2.321254392643209,-0.8082194792409814,12.74208970062704,-3.279658239005892,-2.173172596533064,7.528779880776423],[1.5654570681129927,2.769328067672313,15.480239411886403,-2.140546923806027,-0.01001783530562994,3.6248120772254824],[-3.2252673968044285,2.782075252917054,16.031686028891365,1.742164718730681,-0.6833417168897342,2.0167469168283323],[1.845115441404023,0.6165431435909682,11.888676794822942,3.182428312846345,-3.5756007325517705,5.799355253836916],[2.3438016057609414,-3.6529419302894177,11.88656442911474,-2.2623152989632924,2.4302873015932107,7.966718686417109],[0.901536324520001,-3.821849711513563,14.563071633373921,-2.8367028232885265,2.7801601095699953,1.1406731225131943],[1.226544646530402,-0.09399865273959189,13.058655291178635,3.8584475627803014,2.475580903810336,2.3379381039218883],[0.8477349536210852,-3.42075455050348,17.864903548430206,0.6345567590198762,-2.627638533833155,6.145075838492342],[3.5248541545482746,3.1608506034741377,14.63517189947454,0.09391178606602324,2.6923395627779314,1.5566011571576164],[3.2080563521838927,-2.066322809074323,17.570671455570377,1.9945526759244467,3.2368561320066638,0.5805644222862919],[-2.4267323185695573,-4.131092687270198,10.087027361816238,0.9236111958727662,3.053990469063324,3.763302269517979],[0.737179053410457,2.580060880239805,17.74241358698152,-0.6665143340666524,0.7053447271113722,1.2832770878506436],[-0.03785414854033914,2.0868807161701133,11.574767599597852,2.476989471922378,-0.0051354777956014175,0.7821055202725146],[1.8036904971745278,0.4423513550379358,12.830128229537554,0.8122480583948697,-0.8621474929250166,7.757759056488631],[-3.1928205110946193,-4.1408709792147675,14.36471758124904,-1.0051272054131615,1.3068870815964626,6.5454484478682895],[0.25757735071082505,0.27650854703538147,10.328310064193985,-2.987801651074959,0.9789367037089249,4.4013133686044945],[2.1930457774563443,-3.4734915893632516,17.782638637507635,1.5411911241239515,1.9780906773421538,1.395785759482604],[-3.0016473280384597,-3.799240836250933,15.65879129905275,0.13994013465312705,-2.436469884032224,5.68044361306932],[-0.8396188603672217,0.5045948436812735,17.710490191608976,-3.3424482600086525,3.6844463348889382,1.8744086581393653],[0.4258797325764101,1.5882056500925597,15.258048816857427,-0.2796443403609348,3.89078129619158,6.044642593021432],[-2.2805034301971396,-2.298133643595636,15.593641713033948,3.2068953823912825,3.3459987231808537,6.473268549358257],[-2.486838996816597,-3.2634694594382765,15.517517728675585,-0.04754574313605753,1.7819604358320618,3.8464042065728714],[1.4966663936398428,-3.002841862640342,17.65133757998974,1.6892274418157136,-1.533745700706473,2.069400493779026],[3.115477592584216,0.6135369304081313,11.99489395977338,0.821481644408923,1.1061997383323154,2.540943844293194],[0.5182480186555182,-2.924043480097395,11.196391614761975,3.90983463850063,2.9827617300922746,4.7873757883674335],[-1.8057103629619278,3.299038034877102,12.42124277250218,3.510837251564663,-3.8663193737429915,4.240104821403869],[0.6407639468104864,2.270482156642639,16.752942942973363,3.5420256093779665,-2.3277013945146674,1.666924830551795],[2.772686065502158,1.4062321996337972,13.42564334772732,-1.568897566734397,3.5090110432398856,4.746462035000001],[0.6782792004179097,-1.938176449788117,11.618885946162747,3.234754004615618,2.757507633629249,6.815017867120499],[-2.758480103600905,0.3987149267133847,15.327443670103781,1.0873966871700071,-0.7617530305654725,1.7150445521430828],[0.8838434870158343,0.8728658587162614,11.09719290680203,-2.916225457377782,2.995257756630651,5.044750779912811],[-3.7157091814538292,-2.219541524738656,11.530580523063835,3.7641647766399133,1.9018966137336974,3.4082724899731245],[-4.197745730471758,-3.0175129232827165,10.365098713919423,-3.676958652781399,-0.40605453019218407,1.9268944575914542],[-1.6820670439167165,0.8519923418736907,13.60135866550688,1.627425155079548,2.1761363159345244,6.0439781080563995],[-2.3942111383714173,-2.0205795339203454,9.937768803619509,3.8127043092387307,0.7625218556378712,3.7123406011402715],[0.4102626215454478,0.476927846315998,13.995207553837586,-1.7264612486056858,-0.5910653881773893,3.083222111720516],[-1.7018616357169891,0.18954699091741545,14.180555028314773,-2.350953389831089,-0.24902475427842852,4.574403050710799],[2.9416554763393616,-2.419951091634248,15.541826129204528,1.7056287233653027,-2.7409994498272114,0.6481206457868002],[-2.6271124658708347,-2.129985147736845,15.376023391169262,1.5948534746427283,-3.5799497831131397,5.991993185515009],[-3.3542137443846354,1.953661427737208,15.49828728417776,-3.2675330555085633,-1.5425429936751418,7.992930143669921],[-4.065733304541119,3.60746603121344,11.009129128531344,1.590925328084218,-2.295352850362097,3.7748264593860084],[0.47907758451553206,2.8344248217928336,15.705351756304738,1.6567930923947483,2.8512237834870806,0.064069386604131],[3.600680650785376,3.021557479777808,14.02029076883288,1.6416182639233838,-3.831710885008425,6.09501479085913],[-0.8948334290762536,2.320775531556159,14.127893547697015,-0.290858426665515,-3.0828102502587984,0.5751067220041703],[1.7424319758952578,2.400907360560025,15.397754754628885,-1.2562107754773106,-1.5254800530151194,1.095400887184908],[-0.45674140048954714,-2.8334915116635173,10.272599265108443,3.224766166837526,2.2865349537262105,3.6142832847662847],[0.9580740595232877,3.4158358809180154,14.300091954754198,3.6343173131011586,-1.245778943608749,0.8210912412395572],[-0.5655633371526348,-1.9817432182611359,10.483157193440922,-2.648549411710745,3.607303721176029,4.816669457872928],[3.529258233677193,0.23625344274706378,14.66750780195397,1.2972128034164285,-2.8937221390409094,4.023249316683486],[-3.3652033120266758,2.681320924333793,13.83099142302277,-2.0781968995503677,3.043855051936734,6.367897644167916],[3.4591006180916875,3.922085831036039,15.068359580119836,-2.898630014526906,1.5180557374402142,5.737845437221564],[3.10794875199621,0.488367837006665,17.59389812640887,3.487545158827688,-0.7406082764150947,3.273331191651935],[-1.1896305869913726,-1.2233759056729994,16.22728580200427,-2.1127326061481013,-2.9918211187453077,3.529715001634827],[-1.1914454291740184,-3.272515308300512,10.690603140656606,0.7491674286578833,-1.4716873533925425,1.5475561689786659],[-1.4500518770355555,-2.74535904569697,11.610723145658508,3.95162614173155,-3.553334425064941,0.09949730842057516],[1.8531158419408091,-3.0026673741346883,15.165767800636523,0.8069059592318073,-1.157308174446292,1.1542943838815858],[3.655666476998537,0.31112311069540716,13.780917473708358,-3.7535685146154973,3.1342696149351443,2.8025019219893172],[1.903114598163825,-1.8054267535742796,17.01495161036617,1.7053415029741998,-3.0558328986289043,5.389050775119971],[1.155443700868329,-4.160031660179868,13.367467446947717,-0.1755015633830017,2.630694479194026,6.883404894580326],[2.6601113264711373,-1.4074951258523003,15.943714334748579,0.977532713137121,1.19689864214158,4.187232835637776],[-1.7458903390668898,-1.215307500996989,14.933439026497812,-1.759688217985218,3.7224004986859285,4.473595558387156],[2.973323795186587,1.3184498830723614,13.256538911766041,1.5440244415668891,2.8007593661778296,0.7913445286703926],[-2.1025058817571534,-1.7270000239982766,9.716540860298265,2.458012328279354,-3.1950982843695104,3.3191207365223048],[3.1485519565745914,-2.329346880732735,11.232199065199193,-0.7695556362559497,1.105888089443516,1.077024140754222],[0.6923772689653223,-2.9111652025904498,15.98120483264977,-2.4454102902683887,-3.7037529108173644,0.6708135097700815],[-0.18489414938681198,-2.845889451235094,11.883386326117845,-3.759187998953764,-2.515277194228603,3.2147418460542303],[-3.2931456502571734,1.3871175808000789,10.12616655418083,-3.9847783967591095,2.450765136023393,0.47311595990170247],[2.4895861421655185,-2.8694544034904226,13.536986598265827,-1.473762889457586,-2.875847898261181,5.095856838724848],[-1.1016201837706285,-2.227912080263786,14.234359277018571,-2.5529000608382946,-2.2236892059852478,3.80915783842372],[1.9932820867155068,1.4034610392922022,17.861831054672454,3.270876288297825,1.0510383766831959,3.8362187149532603],[-3.384142277630645,-0.040722572159952314,15.26217039129529,-2.214618977838502,0.06693569799064569,0.15496857823052165],[-1.2474187433512383,-3.9668480507575414,17.35996165817668,3.630020367117753,3.4226417546434025,5.24267557111797],[1.440475506390056,-3.8229747394780405,16.919266232680133,3.901023337987832,-3.641264934847135,3.294529259727777],[-2.7357010495546015,-3.673916413661301,17.054004165306516,1.1848063079071558,2.3328704840692662,4.318596197280974],[-3.529703359640508,-2.70119737649071,14.14076393992965,0.4213420095493987,-0.7168634780280683,4.966246406208711],[-1.7791076042011635,1.322541519281926,17.60996883379936,1.3640498518850492,1.0397748828706925,4.838564500917573],[-0.029248176805824144,-3.3568419903004227,14.349807192903505,3.1562035382499083,-1.1916126220053078,2.4381577944232764],[0.8273747287789317,-0.17356548129377225,15.575254306265869,-0.7399091157535809,-1.969233460745027,1.0166212400113404],[-2.863510901519617,-3.25113241850934,13.033339116565754,-1.93504787325565,0.8847680214831231,4.884848328347089],[-1.3957336789870902,0.7637724530213202,13.017794996569792,-3.340302732779575,2.3357253734807006,1.2571230496265717],[-2.175473951597019,-2.7389461872416576,10.485726049887433,-1.955584529502448,3.3452815052650893,0.21668111854819777],[1.7528541583808988,-0.4506093270682022,11.395265447026532,-3.4463380735503666,3.5742080303050967,1.2554731785092248],[2.6801969900306624,-2.470026773660112,16.768071769355156,-0.31143950371295226,-1.018835822748088,4.3801337460874725],[-3.0370699825850287,-0.7044888873642151,10.146326518150751,-0.052965530270214334,2.702925111330634,1.4522833826516452],[2.569460258783441,-2.788120166921086,13.80653278710291,1.5333057312918204,0.7179454084508565,7.938061224313375],[-2.650316417659412,-3.487908645448286,10.669315915843594,1.765774074941742,-2.5010316535757307,3.6605961480306197],[1.9128238387192757,-2.104926105358227,10.697248383114683,1.1532613370534284,1.2649829607637129,7.953449620172275],[-1.188991847452313,-3.6529842177502996,17.96739871329561,-1.6607015196809365,-0.49390743212369737,6.353482716220097],[0.7531397149272349,-2.599506286770548,17.74932147765531,-0.4662784511281548,3.9747721959218874,1.0403908145262348],[-0.9450542895134464,0.11897121463705812,12.36478990488677,0.07148432953978645,-2.087446190230629,3.4116350855149884],[-1.5131529446818401,-0.891935122715573,15.887457373354648,0.5077898068729896,-0.8486690787034163,4.792901518684203],[-1.8826669972981904,-1.8918764273248658,11.84253479212457,-1.2745237597706467,1.664475219781485,4.046332927927258],[-2.629017122946636,-1.9494815095171452,13.716532256577235,-3.8616463088281594,2.7512724552394916,0.9388033370684169],[3.188816017073554,-0.3653394858900433,14.82587684554094,2.7635037168734113,-0.8372844196099041,6.218011663623436],[0.2748585157097303,1.5098257251891456,14.515035650207363,0.06712122556032263,-3.245138652861651,5.359577162126793],[-2.3073345160248357,0.3461247760465165,15.730280547238712,-3.464437283570287,2.8045515387097684,4.993636599380578],[-1.294888442803984,-0.6121659727246975,10.582539314134712,-3.2181760692797337,2.48479808146031,2.79378244777136],[-2.968224390353841,0.9273692263878852,15.528670819405757,-0.586945791022405,0.5925061459177332,3.810083937270954],[1.5049931118697568,-1.471074196710435,12.857468831009676,0.09362294846597763,-2.023588503780786,0.0367222376632125],[1.2262762927909077,2.4629508234331925,16.802576082637245,-1.378978699929506,-0.4332706391566723,0.7856237666577203],[1.199272242764708,-0.20448455898526605,14.950580803015914,-3.0036323457948964,-3.747169942340038,6.371389869089894],[-2.6898754816988255,1.564046297822408,14.496192842989695,1.16636299460657,-0.8983172935756545,1.2290472723711363],[-1.301443049685175,2.890439731151982,11.603282606167827,1.012122275369089,3.283246949048336,4.154173013549246],[3.333987674767731,-0.6123141212434013,16.108103023621737,-3.3230166691577043,-0.8567901071467441,2.1666104192034266],[-3.4257048341441805,-3.8561399698857493,16.894473521489445,0.21289726511757756,0.4426224556795253,3.009908504267916],[-1.875185021213136,0.47936988733292174,17.099500964774364,0.005355958933993321,0.3389824205515799,3.5971476117253074],[-3.835312257025186,-0.4978882149932156,12.044024360583265,-3.10801117973439,1.4777231491957892,7.363911097454464],[-1.8321380404547287,0.8651499039485853,11.56449520295303,3.087039321911119,-3.986789372972882,6.4274413797637635],[-0.4739600522846292,2.6903266499164724,15.509451870561564,3.121728675126331,3.447623123914469,7.049984024725653],[-3.3608176821235785,1.899949363714628,12.521524017792048,-2.614179665743873,1.5528785896710104,3.5012692348526846],[3.633452030412408,-0.36644152836412563,11.819723234177175,-0.018669915236706913,-3.0758863978229285,7.706034363032435],[-2.415092240945644,-1.5436589997521857,13.60343508501383,-1.05051113518362,1.7070904573487375,6.756267008536459],[1.977718874210269,-1.648626904803131,13.315852834100946,3.951263642877711,-0.2154144905552533,0.5896732765071346],[-1.7197425966582582,-2.675168256497255,11.151933523061023,1.1082681944683062,-1.8719433248532753,3.066982681924388],[0.48262203734877474,-3.3290644788161052,14.70261154424046,-0.005497704778912205,2.7486801423037335,6.4888622085817715],[1.3834852026754403,-0.8686495081784831,15.626047413183677,-1.325305906577476,0.731065622643122,6.53354803812746],[2.8461475435724752,3.3021478926731818,10.23360280347558,-3.7143525396447417,-2.0548966569839706,5.037790746074866],[2.2440084406572205,2.8258638311941593,17.745549945628877,-2.65504511545425,-0.7961190855121418,3.2807486311323864],[3.245014809845977,-4.006864293853338,14.286244025223956,-3.267147937866684,-2.653783301686416,0.5637486371244015],[-0.766094204674683,1.946122661218405,15.102682621735138,-1.6389533025074967,2.8626759395165706,2.4563166772872242],[3.4158413810370636,1.6412395480700106,9.938626807164669,-1.2822558673493751,0.16229162309215717,5.135080101017292],[0.6751771565742488,-1.8949651573323896,12.223432090588094,-1.4489896136928633,-1.2524011900041416,5.118852194868123],[-3.690885070325062,-3.8336930587122224,13.140458328597054,-2.898676426315654,-1.8473101015278006,2.908875839469312],[2.7671711496024214,-2.742569907623456,14.901295624964716,0.9189677308253756,1.0047384559684271,4.912673265192192],[1.72764132689479,-1.8606167986059383,11.42466344185,2.1487744659724326,-3.498399139945461,6.228400288985974],[1.554131082504417,-3.388048331274093,10.350329847815216,-3.682221349851176,-1.929794037369018,1.0246802134594208],[-2.0534599253749124,0.25021406137366076,10.332390475276219,1.7319495635918054,-1.4595247853188238,3.0132621482680313],[0.8797259218266736,-2.8169936720264834,16.383089809872875,0.13327050969817655,3.712430794822005,1.7574967545938183],[2.436208299710994,2.8590397557982046,11.407944300678926,2.5199177951135585,1.210344035747891,3.0507511011455026],[-3.5683998299546746,1.1096336366050443,12.571911773501466,2.1095310473410187,1.8629818373330052,4.109587973050589],[0.3192059940355956,0.42916168412817574,14.773761871994317,2.52950639457916,-0.8080082895442384,4.511281123924816],[-2.870112729140895,-3.5388847438962667,15.034496235782782,2.440895850032361,-2.1809205113601617,7.395888976780222],[2.1506927489604526,3.210568447949078,12.014726378131682,1.5873258624039996,3.952456510256358,7.675462584020216],[-0.4879960773420141,2.7659581371225475,17.800405401016675,-2.1589470094652436,-1.9160735889358516,6.95898919432698],[-2.169050220560613,-3.369443791710213,16.837560822281688,-2.2887499570593888,2.530896375382408,0.35751382376109536],[1.260533710375686,-2.1455785570510275,16.672124500438184,-1.9280329151196143,-1.856763179407836,1.0786353270328788],[-3.748424119940838,-3.252315342491352,15.512022277804501,-1.748180351369391,1.2178420169699589,5.778417675059224],[2.353232595929774,2.6540236199767437,15.734219600647284,-3.9298947298516524,3.7095181055805515,2.233012155887354],[1.5371905460329294,-0.7046012465006368,13.419661157164093,-3.9099597436342557,-0.045524397807652495,6.136816175414796],[0.23527142932667294,2.672252472889085,10.566587240192119,3.517921176621913,3.7768229235618387,7.987604069982216],[-1.1293206965236846,1.6521620110249275,16.405312194190103,-3.7753269710910575,-1.6604226803833404,0.5339146699748117],[-0.24166061917039214,2.7572706492324226,15.678547268247655,3.392873383452689,0.0810581000295647,1.5253072831488728],[-2.8632633783919474,2.0014807831404275,13.033228060026747,1.7041549868528794,-1.4126734259368297,2.660298376459195],[0.6953479893261614,2.1719739851477504,14.437590020946542,2.6863547614842647,-2.688782793575222,7.084841875964152]];

/*
    initPos[0] = [3237.469146466679,-5638.116180189483,-1986.216001164316];
    initPos[1] = [3871.8622178420264,-5653.703867013482,-2017.4079054566741];;
    initVel[0] = [-44.235922020558185,-482.33519518078464,13.332369929732511,
                  0.3401116790208354,-3.8124016020653073,5.695725977374667];
    initVel[1] = [-124.99667474047756,-381.9687506782039,24.77046963656808,
                  -0.771408920094323,-3.0638334066280426,3.4598735381857164];
*/
    if (mode === "par") {
      NBody.private.pos = new ParallelArray(initPos);
      NBody.private.vel = new ParallelArray(initVel);
    } else {
      NBody.private.pos = initPos;
      NBody.private.vel = initVel;
    }

    NBody.numBodies = numBodies;
    NBody.time = 0;
  },

  // Parallel

  tickPar: function tickPar() {
    var runmode = undefined; // {mode:"seq"};
    var newvel = new ParallelArray([NBody.numBodies], NBody.velocityPar);
    var newpos = new ParallelArray([NBody.numBodies], NBody.positionPar);

    try {
      var newvel2 = new ParallelArray([NBody.numBodies], NBody.velocityPar);
      assertStructuralEq(newvel2, newvel);

      NBody.private.vel = matrixToArrays(NBody.private.vel);
      NBody.private.pos = matrixToArrays(NBody.private.pos);
      var seqvel = new Array(NBody.numBodies);
      var seqpos = new Array(NBody.numBodies);

      for (var i = 0; i < NBody.numBodies; i++) {
        seqpos[i] = NBody.positionSeq(i);
        assertStructuralEq(seqpos[i], newpos.get(i));
      }

    } catch (e) {
        print("mismatch pos on iteration: "+i+
              " time: "+NBody.time+
              " input: "+JSON.stringify(NBody.private)
             );
        throw e;
    }

    for (var i = 0; i < NBody.numBodies; i++) {
      seqvel[i] = NBody.velocitySeq(i);
      try {
        assertStructuralEq(seqvel[i], newvel.get(i));
      } catch (e) {
        print("mismatch vel on iteration: "+i+
              " time: "+NBody.time+
              " input: "+JSON.stringify(NBody.private)+
              "\n seqvel["+i+"]: "+seqvel[i]+
              "\n newvel["+i+"]: "+newvel.get(i)
             );
        throw e;
      }
    }

    assertStructuralEq(newpos, seqpos);
    assertStructuralEq(newvel, seqvel);

    NBody.private.vel = newvel;
    NBody.private.pos = newpos;
    NBody.time++;
  },

  velocityPar: function velocityPar(index) {
    var pos = NBody.private.pos;
    var vel = NBody.private.vel;

    var deltaTime = NBody.Constant.deltaTime;
    var epsSqr = NBody.Constant.epsSqr;
    var time = NBody.time;

    var shape = vel.shape[0];

    var newVel;
    var newX, newY, newZ;
    var newX2, newY2, newZ2;

    var cX = Math.cos(time / 22) * -4200;
    var cY = Math.sin(time / 14) * 9200;
    var cZ = Math.sin(time / 27) * 6000;

    // pull to center
    var maxDistance = 3400;
    var pullStrength = .042;

    var speedLimit = 8;

    // zones
    var zone = 400;
    var repel = 100;
    var align = 300;
    var attract = 100;
    var attractPower;

    if (time < 500) {
      speedLimit = 2000;
      attractPower = 100.9;
    } else {
      speedLimit = .2;
      attractPower = 20.9;
    }

    var zoneSqrd = zone * zone + zone * zone + zone * zone;

    var accX = 0, accY = 0, accZ = 0;
    var accX2 = 0, accY2 = 0, accZ2 = 0;
    var i;

    // define particle 1 center distance
    var dirToCenterX = cX - pos.get(index)[0];
    var dirToCenterY = cY - pos.get(index)[1];
    var dirToCenterZ = cZ - pos.get(index)[2];

    var distanceSquaredTo = dirToCenterX * dirToCenterX + dirToCenterY * dirToCenterY + dirToCenterZ * dirToCenterZ;
    var distToCenter = Math.sqrt(distanceSquaredTo);

    // orient to center
    if (distToCenter > maxDistance) {
      var velc = (distToCenter - maxDistance) * pullStrength;
      if (time < 200)
        velc = .2;
      else velc = (distToCenter - maxDistance) * pullStrength;

      accX += (dirToCenterX / distToCenter) * velc;
      accY += (dirToCenterY / distToCenter) * velc;
      accZ += (dirToCenterZ / distToCenter) * velc;
    }

    for (i = 0; i < shape; i = i + 1) {
      var rx = pos.get(i)[0] - pos.get(index)[0];
      var ry = pos.get(i)[1] - pos.get(index)[1];
      var rz = pos.get(i)[2] - pos.get(index)[2];

      // make sure we are not testing the particle against its own position
      var areSame = 0;
      if (pos.get(i)[0] == pos.get(index)[0] && pos.get(i)[1] == pos.get(index)[1] && pos.get(i)[2] == pos.get(index)[2])
        areSame += 1;

      var distSqrd = rx * rx + ry * ry + rz * rz;

      // cant use eqals to test, only <= or >= WTF
      if (distSqrd < zoneSqrd && areSame <= 0) {
        var length = Math.sqrt(distSqrd);
        var percent = distSqrd / zoneSqrd;

        if (distSqrd < repel) {
          var F = (repel / percent - 1) * .025;

          var normalRx = (rx / length) * F;
          var normalRy = (ry / length) * F;
          var normalRz = (rz / length) * F;

          accX = accX + normalRx;
          accY = accY + normalRy;
          accZ = accZ + normalRz;

          accX2 = accX2 - normalRx;
          accY2 = accY2 - normalRy;
          accZ2 = accZ2 - normalRz;
        } else if (distSqrd < align) { //align
          var threshDelta = align - repel;
          var adjustedPercent = (percent - repel) / threshDelta;
          var Q = (.5 - Math.cos(adjustedPercent * 3.14159265 * 2) * .5 + .5) * 100.9;

          // get velocity 2
          var velX2 = vel.get(i)[3];
          var velY2 = vel.get(i)[4];
          var velZ2 = vel.get(i)[5];

          var velLength2 = Math.sqrt(velX2 * velX2 + velY2 * velY2 + velZ2 * velZ2);

          // normalize vel2 and multiply by factor
          velX2 = (velX2 / velLength2) * Q;
          velY2 = (velY2 / velLength2) * Q;
          velZ2 = (velZ2 / velLength2) * Q;

          // get own velocity
          var velX = vel.get(i)[0];
          var velY = vel.get(i)[1];
          var velZ = vel.get(i)[2];

          var velLength = Math.sqrt(velX * velX + velY * velY + velZ * velZ);

          // normalize own velocity
          velX = (velX / velLength) * Q;
          velY = (velY / velLength) * Q;
          velZ = (velZ / velLength) * Q;

          accX += velX2;
          accY += velY2;
          accZ += velZ2;

          accX2 += velX;
          accY2 += velY;
          accZ2 += velZ;
        }

        if (distSqrd > attract) { // attract
          var threshDelta2 = 1 - attract;
          var adjustedPercent2 = (percent - attract) / threshDelta2;
          var C = (1 - (Math.cos(adjustedPercent2 * 3.14159265 * 2) * 0.5 + 0.5)) * attractPower;

          // normalize the distance vector
          var dx = (rx / (length)) * C;
          var dy = (ry / (length)) * C;
          var dz = (rz / (length)) * C;

          accX += dx;
          accY += dy;
          accZ += dz;

          accX2 -= dx;
          accY2 -= dy;
          accZ2 -= dz;
        }
      }
    }

    // enforce speed limits
    if (time > 500) {
      var accSquared = accX * accX + accY * accY + accZ * accZ;
      if (accSquared > speedLimit) {
        accX = accX * .015;
        accY = accY * .015;
        accZ = accZ * .015;
      }

      var accSquared2 = accX2 * accX2 + accY2 * accY2 + accZ2 * accZ2;
      if (accSquared2 > speedLimit) {
        accX2 = accX2 * .015;
        accY2 = accY2 * .015;
        accZ2 = accZ2 * .015;
      }
    }

    // Caclulate new velocity
    newX = (vel.get(index)[0]) + accX;
    newY = (vel.get(index)[1]) + accY;
    newZ = (vel.get(index)[2]) + accZ;

    newX2 = (vel.get(index)[3]) + accX2;
    newY2 = (vel.get(index)[4]) + accY2;
    newZ2 = (vel.get(index)[5]) + accZ2;

    if (time < 500) {
      var acs = newX2 * newX2 + newY2 * newY2 + newZ2 * newZ2;
      if (acs > speedLimit) {
        newX2 = newX2 * .15;
        newY2 = newY2 * .15;
        newZ2 = newZ2 * .15;
      }

      var acs2 = newX * newX + newY * newY + newZ * newZ;
      if (acs2 > speedLimit) {
        newX = newX * .15;
        newY = newY * .15;
        newZ = newZ * .15;
      }
    }

    return [newX, newY, newZ, newX2, newY2, newZ2];
  },

  positionPar: function positionPar(index) {
    var vel = NBody.private.vel;
    var pos = NBody.private.pos;

    var x = 0;
    var y = 0;
    var z = 0;

    var velX = vel.get(index)[0];
    var velY = vel.get(index)[1];
    var velZ = vel.get(index)[2];

    var velX2 = vel.get(index)[3];
    var velY2 = vel.get(index)[4];
    var velZ2 = vel.get(index)[5];

    var netVelX = (velX - velX2);
    var netVelY = (velY - velY2);
    var netVelZ = (velZ - velZ2);

    x = pos.get(index)[0] + netVelX;
    y = pos.get(index)[1] + netVelY;
    z = pos.get(index)[2] + netVelZ;

    return [x, y, z];
  },

  // Sequential

  tickSeq: function tickSeq() {
    var numBodies = NBody.numBodies;
    var newVel = new Array(numBodies);
    var newPos = new Array(numBodies);

    for (var i = 0; i < numBodies; i++)
      newVel[i] = NBody.velocitySeq(i);

    for (var i = 0; i < numBodies; i++)
      newPos[i] = NBody.positionSeq(i);

    NBody.private.vel = newVel;
    NBody.private.pos = newPos;

    NBody.time++;
  },

  velocitySeq: function velocitySeq(index) {
    var pos = NBody.private.pos;
    var vel = NBody.private.vel;

    var deltaTime = NBody.Constant.deltaTime;
    var epsSqr = NBody.Constant.epsSqr;
    var time = NBody.time;

    var shape = pos.length;

    var newVel;
    var newX, newY, newZ;
    var newX2, newY2, newZ2;

    var cX = Math.cos(time / 22) * -4200;
    var cY = Math.sin(time / 14) * 9200;
    var cZ = Math.sin(time / 27) * 6000;

    // pull to center
    var maxDistance = 3400;
    var pullStrength = .042;

    var speedLimit = 8;

    // zones
    var zone = 400;
    var repel = 100;
    var align = 300;
    var attract = 100;
    var attractPower;

    if (time < 500) {
      speedLimit = 2000;
      attractPower = 100.9;
    } else {
      speedLimit = .2;
      attractPower = 20.9;
    }

    var zoneSqrd = zone * zone + zone * zone + zone * zone;

    var accX = 0, accY = 0, accZ = 0;
    var accX2 = 0, accY2 = 0, accZ2 = 0;
    var i;

    // define particle 1 center distance
    var dirToCenterX = cX - pos.get(index)[0];
    var dirToCenterY = cY - pos.get(index)[1];
    var dirToCenterZ = cZ - pos.get(index)[2];

    var distanceSquaredTo = dirToCenterX * dirToCenterX + dirToCenterY * dirToCenterY + dirToCenterZ * dirToCenterZ;
    var distToCenter = Math.sqrt(distanceSquaredTo);

    // orient to center
    if (distToCenter > maxDistance) {
      var velc = (distToCenter - maxDistance) * pullStrength;
      if (time < 200)
        velc = .2;
      else velc = (distToCenter - maxDistance) * pullStrength;

      accX += (dirToCenterX / distToCenter) * velc;
      accY += (dirToCenterY / distToCenter) * velc;
      accZ += (dirToCenterZ / distToCenter) * velc;
    }

    for (i = 0; i < shape; i = i + 1) {
      var rx = pos.get(i)[0] - pos.get(index)[0];
      var ry = pos.get(i)[1] - pos.get(index)[1];
      var rz = pos.get(i)[2] - pos.get(index)[2];

      // make sure we are not testing the particle against its own position
      var areSame = 0;
      if (pos.get(i)[0] == pos.get(index)[0] && pos.get(i)[1] == pos.get(index)[1] && pos.get(i)[2] == pos.get(index)[2])
        areSame += 1;

      var distSqrd = rx * rx + ry * ry + rz * rz;

      // cant use eqals to test, only <= or >= WTF
      if (distSqrd < zoneSqrd && areSame <= 0) {
        var length = Math.sqrt(distSqrd);
        var percent = distSqrd / zoneSqrd;

        if (distSqrd < repel) {
          var F = (repel / percent - 1) * .025;

          var normalRx = (rx / length) * F;
          var normalRy = (ry / length) * F;
          var normalRz = (rz / length) * F;

          accX = accX + normalRx;
          accY = accY + normalRy;
          accZ = accZ + normalRz;

          accX2 = accX2 - normalRx;
          accY2 = accY2 - normalRy;
          accZ2 = accZ2 - normalRz;
        } else if (distSqrd < align) { //align
          var threshDelta = align - repel;
          var adjustedPercent = (percent - repel) / threshDelta;
          var Q = (.5 - Math.cos(adjustedPercent * 3.14159265 * 2) * .5 + .5) * 100.9;

          // get velocity 2
          var velX2 = vel.get(i)[3];
          var velY2 = vel.get(i)[4];
          var velZ2 = vel.get(i)[5];

          var velLength2 = Math.sqrt(velX2 * velX2 + velY2 * velY2 + velZ2 * velZ2);

          // normalize vel2 and multiply by factor
          velX2 = (velX2 / velLength2) * Q;
          velY2 = (velY2 / velLength2) * Q;
          velZ2 = (velZ2 / velLength2) * Q;

          // get own velocity
          var velX = vel.get(i)[0];
          var velY = vel.get(i)[1];
          var velZ = vel.get(i)[2];

          var velLength = Math.sqrt(velX * velX + velY * velY + velZ * velZ);

          // normalize own velocity
          velX = (velX / velLength) * Q;
          velY = (velY / velLength) * Q;
          velZ = (velZ / velLength) * Q;

          accX += velX2;
          accY += velY2;
          accZ += velZ2;

          accX2 += velX;
          accY2 += velY;
          accZ2 += velZ;
        }

        if (distSqrd > attract) { // attract
          var threshDelta2 = 1 - attract;
          var adjustedPercent2 = (percent - attract) / threshDelta2;
          var C = (1 - (Math.cos(adjustedPercent2 * 3.14159265 * 2) * 0.5 + 0.5)) * attractPower;

          // normalize the distance vector
          var dx = (rx / (length)) * C;
          var dy = (ry / (length)) * C;
          var dz = (rz / (length)) * C;

          accX += dx;
          accY += dy;
          accZ += dz;

          accX2 -= dx;
          accY2 -= dy;
          accZ2 -= dz;
        }
      }
    }

    // enforce speed limits
    if (time > 500) {
      var accSquared = accX * accX + accY * accY + accZ * accZ;
      if (accSquared > speedLimit) {
        accX = accX * .015;
        accY = accY * .015;
        accZ = accZ * .015;
      }

      var accSquared2 = accX2 * accX2 + accY2 * accY2 + accZ2 * accZ2;
      if (accSquared2 > speedLimit) {
        accX2 = accX2 * .015;
        accY2 = accY2 * .015;
        accZ2 = accZ2 * .015;
      }
    }

    // Caclulate new velocity
    newX = (vel.get(index)[0]) + accX;
    newY = (vel.get(index)[1]) + accY;
    newZ = (vel.get(index)[2]) + accZ;

    newX2 = (vel.get(index)[3]) + accX2;
    newY2 = (vel.get(index)[4]) + accY2;
    newZ2 = (vel.get(index)[5]) + accZ2;

    if (time < 500) {
      var acs = newX2 * newX2 + newY2 * newY2 + newZ2 * newZ2;
      if (acs > speedLimit) {
        newX2 = newX2 * .15;
        newY2 = newY2 * .15;
        newZ2 = newZ2 * .15;
      }

      var acs2 = newX * newX + newY * newY + newZ * newZ;
      if (acs2 > speedLimit) {
        newX = newX * .15;
        newY = newY * .15;
        newZ = newZ * .15;
      }
    }

    return [newX, newY, newZ, newX2, newY2, newZ2];
  },

  positionSeq: function positionSeq(index) {
    var vel = NBody.private.vel;
    var pos = NBody.private.pos;

    var x = 0;
    var y = 0;
    var z = 0;

    var velX = vel.get(index)[0];
    var velY = vel.get(index)[1];
    var velZ = vel.get(index)[2];

    var velX2 = vel.get(index)[3];
    var velY2 = vel.get(index)[4];
    var velZ2 = vel.get(index)[5];

    var netVelX = (velX - velX2);
    var netVelY = (velY - velY2);
    var netVelZ = (velZ - velZ2);

    x = pos.get(index)[0] + netVelX;
    y = pos.get(index)[1] + netVelY;
    z = pos.get(index)[2] + netVelZ;

    return [x, y, z];
  }
};

function matrixToArrays(m) {
  var a = [];
  if (m.shape.length == 1) {
    for (var i = 0; i < m.shape[0]; i++) {
      a.push(m.get(i));
    }
  } else {
    for (var i = 0; i < m.shape[0]; i++) {
      a.push(matrixToArrays(m.get(i)));
    }
  }
  return a;
}

function emulateNBody(mode, numBodies, ticks) {
  NBody.init(mode, numBodies);
  for (var i = 0; i < ticks; i++) {
    var start = Date.now();
    if (mode === "par")
      NBody.tickPar();
    else
      NBody.tickSeq();
    //print(NBody.private.pos);
    print(mode + " bodies=" + numBodies + " tick=" + (i+1) + "/" + ticks + ": " + (Date.now() - start) + " ms");
  }
  var ret;
  if (mode === "par") {
    ret = {pos:matrixToArrays(NBody.private.pos),
           vel:matrixToArrays(NBody.private.vel)};
    print("par: "+JSON.stringify(ret));
  } else {
    ret = NBody.private;
    print("seq: "+JSON.stringify(ret));
  }
  return ret;
}

function testVelocitySeq(index, vel, pos) {
    function db(name, val) { if (false) print("seq: "+name+": "+val); }
    var deltaTime = NBody.Constant.deltaTime;
    var epsSqr = NBody.Constant.epsSqr;
    var time = NBody.time;

    var shape = pos.length;

    var newVel;
    var newX, newY, newZ;
    var newX2, newY2, newZ2;

    var cX = Math.cos(time / 22) * -4200;
    var cY = Math.sin(time / 14) * 9200;
    var cZ = Math.sin(time / 27) * 6000;

    // pull to center
    var maxDistance = 3400;
    var pullStrength = .042;

    var speedLimit = 8;

    // zones
    var zone = 400;
    var repel = 100;
    var align = 300;
    var attract = 100;


    if (time < 500) {
      speedLimit = 2000;
      var attractPower = 100.9;
    } else {
      speedLimit = .2;
      attractPower = 20.9;
    }

    var zoneSqrd = zone * zone + zone * zone + zone * zone;

    var accX = 0, accY = 0, accZ = 0;
    var accX2 = 0, accY2 = 0, accZ2 = 0;
    var i;

    // define particle 1 center distance
    var dirToCenterX = cX - pos[index][0];
    var dirToCenterY = cY - pos[index][1];
    var dirToCenterZ = cZ - pos[index][2];

    var distanceSquaredTo = dirToCenterX * dirToCenterX + dirToCenterY * dirToCenterY + dirToCenterZ * dirToCenterZ;
    var distToCenter = Math.sqrt(distanceSquaredTo);

    // orient to center
    if (distToCenter > maxDistance) {
      var velc = (distToCenter - maxDistance) * pullStrength;
      if (time < 200)
        velc = .2;
      else velc = (distToCenter - maxDistance) * pullStrength;

      accX += (dirToCenterX / distToCenter) * velc;
      accY += (dirToCenterY / distToCenter) * velc;
      accZ += (dirToCenterZ / distToCenter) * velc;
    }

    db("accX postctrorient", accX);
  
    for (i = 0; i < shape; i = i + 1) {
      var rx = pos[i][0] - pos[index][0];
      var ry = pos[i][1] - pos[index][1];
      var rz = pos[i][2] - pos[index][2];

      db("pos on index "+ index, pos.get(index));
      db("pos on i"+i, pos.get(i));
      db("[rx,ry,rz] on i"+i, [rx,ry,rz]);

      var areSame = 0;
      if (pos[i][0] == pos[index][0] && pos[i][1] == pos[index][1] && pos[i][2] == pos[index][2])
        areSame += 1;

      var distSqrd = rx * rx + ry * ry + rz * rz;

      db("distSqrd init", distSqrd);

      // cant use eqals to test, only <= or >= WTF
      if (distSqrd < zoneSqrd && areSame <= 0) {
        var length = Math.sqrt(distSqrd);
        var percent = distSqrd / zoneSqrd;


        if (distSqrd < repel) {
          var F = (repel / percent - 1) * .025;

          var normalRx = (rx / length) * F;
          var normalRy = (ry / length) * F;
          var normalRz = (rz / length) * F;

          accX = accX + normalRx;
          accY = accY + normalRy;
          accZ = accZ + normalRz;

          accX2 = accX2 - normalRx;
          accY2 = accY2 - normalRy;
          accZ2 = accZ2 - normalRz;

          db("accX iter i"+i+ " post repel "+normalRx, accX);

        } else if (distSqrd < align) { //align
          var threshDelta = align - repel;
          var adjustedPercent = (percent - repel) / threshDelta;
          var Q = (.5 - Math.cos(adjustedPercent * 3.14159265 * 2) * .5 + .5) * 100.9;

          // get velocity 2
          var velX2 = vel[i][3];
          var velY2 = vel[i][4];
          var velZ2 = vel[i][5];

          db("vel[X,Y,Z]2 iter i"+i, [velX2, velY2, velZ2]);

          var velLength2 = Math.sqrt(velX2 * velX2 + velY2 * velY2 + velZ2 * velZ2);
          db("velLength2 iter i"+i, velLength2);

          // normalize vel2 and multiply by factor
          velX2 = (velX2 / velLength2) * Q;
          velY2 = (velY2 / velLength2) * Q;
          velZ2 = (velZ2 / velLength2) * Q;

          db("velX2 iter i"+i, velX2);
          db("Q iter i"+i, Q);

          // get own velocity
          var velX = vel[i][0];
          var velY = vel[i][1];
          var velZ = vel[i][2];

          var velLength = Math.sqrt(velX * velX + velY * velY + velZ * velZ);

          // normalize own velocity
          velX = (velX / velLength) * Q;
          velY = (velY / velLength) * Q;
          velZ = (velZ / velLength) * Q;

          accX += velX2;
          accY += velY2;
          accZ += velZ2;

          accX2 += velX;
          accY2 += velY;
          accZ2 += velZ;

          db("accX iter i"+i+ " post align "+velX2, accX);
        }

        if (distSqrd > attract) {        //attract
          var threshDelta2 = 1 - attract;
          var adjustedPercent2 = (percent - attract) / threshDelta2;
          var C = (1 - (Math.cos(adjustedPercent2 * 3.14159265 * 2) * 0.5 + 0.5)) * attractPower;

          // normalize the distance vector
          var dx = (rx / (length)) * C;
          var dy = (ry / (length)) * C;
          var dz = (rz / (length)) * C;

          accX += dx;
          accY += dy;
          accZ += dz;

          accX2 -= dx;
          accY2 -= dy;
          accZ2 -= dz;

          db("accX iter i"+i+ " post attract "+dx, accX);

        }
      }

      db("accX end iter i"+i, accX);

    }

    db("accX prethrottle", accX);
    // enforce speed limits
    if (time > 500) {
      var accSquared = accX * accX + accY * accY + accZ * accZ;
      if (accSquared > speedLimit) {
        accX = accX * .015;
        accY = accY * .015;
        accZ = accZ * .015;
      }

      var accSquared2 = accX2 * accX2 + accY2 * accY2 + accZ2 * accZ2;
      if (accSquared2 > speedLimit) {
        accX2 = accX2 * .015;
        accY2 = accY2 * .015;
        accZ2 = accZ2 * .015;
      }
    }

    db("accX final", accX);

    // Caclulate new velocity
    newX = vel[index][0] + accX;
    newY = vel[index][1] + accY;
    newZ = vel[index][2] + accZ;

    newX2 = vel[index][3] + accX2;
    newY2 = vel[index][4] + accY2;
    newZ2 = vel[index][5] + accZ2;

    db("newX pretemps", newX);
    if (time < 500) {
      var acs = newX2 * newX2 + newY2 * newY2 + newZ2 * newZ2;
      if (acs > speedLimit) {
        newX2 = newX2 * .15;
        newY2 = newY2 * .15;
        newZ2 = newZ2 * .15;
      }

      var acs2 = newX * newX + newY * newY + newZ * newZ;
      if (acs2 > speedLimit) {
        newX = newX * .15;
        newY = newY * .15;
        newZ = newZ * .15;
      }
    }

    db("newX final", newX);
    return [newX, newY, newZ, newX2, newY2, newZ2];
  }

function testVelocityPar(index, vel, pos) {
    function db(name, val) { if (false) print("par: "+name+": "+val); }
    var deltaTime = NBody.Constant.deltaTime;
    var epsSqr = NBody.Constant.epsSqr;
    var time = NBody.time;

    var shape = vel.shape[0];

    var newVel;
    var newX, newY, newZ;
    var newX2, newY2, newZ2;

    var cX = Math.cos(time / 22) * -4200;
    var cY = Math.sin(time / 14) * 9200;
    var cZ = Math.sin(time / 27) * 6000;

    // pull to center
    var maxDistance = 3400;
    var pullStrength = .042;

    var speedLimit = 8;

    // zones
    var zone = 400;
    var repel = 100;
    var align = 300;
    var attract = 100;

    if (time < 500) {
      speedLimit = 2000;
      var attractPower = 100.9;
    } else {
      speedLimit = .2;
      attractPower = 20.9;
    }

    var zoneSqrd = zone * zone + zone * zone + zone * zone;

    var accX = 0, accY = 0, accZ = 0;
    var accX2 = 0, accY2 = 0, accZ2 = 0;
    var i;

    // define particle 1 center distance
    var dirToCenterX = cX - pos.get(index)[0];
    var dirToCenterY = cY - pos.get(index)[1];
    var dirToCenterZ = cZ - pos.get(index)[2];

    var distanceSquaredTo = dirToCenterX * dirToCenterX + dirToCenterY * dirToCenterY + dirToCenterZ * dirToCenterZ;
    var distToCenter = Math.sqrt(distanceSquaredTo);

    // orient to center
    if (distToCenter > maxDistance) {
      var velc = (distToCenter - maxDistance) * pullStrength;
      if (time < 200)
        velc = .2;
      else velc = (distToCenter - maxDistance) * pullStrength;

      accX += (dirToCenterX / distToCenter) * velc;
      accY += (dirToCenterY / distToCenter) * velc;
      accZ += (dirToCenterZ / distToCenter) * velc;
    }

    db("accX postctrorient", accX);

    for (i = 0; i < shape; i = i + 1) {
      var rx = pos.get(i)[0] - pos.get(index)[0];
      var ry = pos.get(i)[1] - pos.get(index)[1];
      var rz = pos.get(i)[2] - pos.get(index)[2];

      db("pos on index "+ index, pos.get(index));
      db("pos on i"+i, pos.get(i));
      db("[rx,ry,rz] on i"+i, [rx,ry,rz]);

      // make sure we are not testing the particle against its own position
      var areSame = 0;
      if (pos.get(i)[0] == pos.get(index)[0] && pos.get(i)[1] == pos.get(index)[1] && pos.get(i)[2] == pos.get(index)[2])
        areSame += 1;

      var distSqrd = rx * rx + ry * ry + rz * rz;

      db("distSqrd init", distSqrd);

      // cant use eqals to test, only <= or >= WTF
      if (distSqrd < zoneSqrd && areSame <= 0) {
        var length = Math.sqrt(distSqrd);
        var percent = distSqrd / zoneSqrd;

        if (distSqrd < repel) {
          var F = (repel / percent - 1) * .025;

          var normalRx = (rx / length) * F;
          var normalRy = (ry / length) * F;
          var normalRz = (rz / length) * F;

          accX = accX + normalRx;
          accY = accY + normalRy;
          accZ = accZ + normalRz;

          accX2 = accX2 - normalRx;
          accY2 = accY2 - normalRy;
          accZ2 = accZ2 - normalRz;

          db("accX iter i"+i+ " post repel "+normalRx, accX);

        } else if (distSqrd < align) { //align
          var threshDelta = align - repel;
          var adjustedPercent = (percent - repel) / threshDelta;
          var Q = (.5 - Math.cos(adjustedPercent * 3.14159265 * 2) * .5 + .5) * 100.9;

          // get velocity 2
          var velX2 = vel.get(i)[3];
          var velY2 = vel.get(i)[4];
          var velZ2 = vel.get(i)[5];

          db("vel[X,Y,Z]2 iter i"+i, [velX2, velY2, velZ2]);

          var velLength2 = Math.sqrt(velX2 * velX2 + velY2 * velY2 + velZ2 * velZ2);
          db("velLength2 iter i"+i, velLength2);

          // normalize vel2 and multiply by factor
          velX2 = (velX2 / velLength2) * Q;
          velY2 = (velY2 / velLength2) * Q;
          velZ2 = (velZ2 / velLength2) * Q;

          db("velX2 iter i"+i, velX2);
          db("Q iter i"+i, Q);

          // get own velocity
          var velX = vel.get(i)[0];
          var velY = vel.get(i)[1];
          var velZ = vel.get(i)[2];

          var velLength = Math.sqrt(velX * velX + velY * velY + velZ * velZ);

          // normalize own velocity
          velX = (velX / velLength) * Q;
          velY = (velY / velLength) * Q;
          velZ = (velZ / velLength) * Q;

          accX += velX2;
          accY += velY2;
          accZ += velZ2;

          accX2 += velX;
          accY2 += velY;
          accZ2 += velZ;

          db("accX iter i"+i+ " post align "+velX2, accX);
        }

        if (distSqrd > attract) { // attract
          var threshDelta2 = 1 - attract;
          var adjustedPercent2 = (percent - attract) / threshDelta2;
          var C = (1 - (Math.cos(adjustedPercent2 * 3.14159265 * 2) * 0.5 + 0.5)) * attractPower;

          // normalize the distance vector
          var dx = (rx / (length)) * C;
          var dy = (ry / (length)) * C;
          var dz = (rz / (length)) * C;

          accX += dx;
          accY += dy;
          accZ += dz;

          accX2 -= dx;
          accY2 -= dy;
          accZ2 -= dz;

          db("accX iter i"+i+ " post attract "+dx, accX);

        }
      }

      db("accX end iter i"+i, accX);

    }

    db("accX prethrottle", accX);
    // Speed limits
    if (time > 500) {
      var accSquared = accX * accX + accY * accY + accZ * accZ;
      if (accSquared > speedLimit) {
        accX = accX * .015;
        accY = accY * .015;
        accZ = accZ * .015;
      }

      var accSquared2 = accX2 * accX2 + accY2 * accY2 + accZ2 * accZ2;
      if (accSquared2 > speedLimit) {
        accX2 = accX2 * .015;
        accY2 = accY2 * .015;
        accZ2 = accZ2 * .015;
      }
    }

    db("accX final", accX);

    // Caclulate new velocity
    newX = (vel.get(index)[0]) + accX;
    newY = (vel.get(index)[1]) + accY;
    newZ = (vel.get(index)[2]) + accZ;

    newX2 = (vel.get(index)[3]) + accX2;
    newY2 = (vel.get(index)[4]) + accY2;
    newZ2 = (vel.get(index)[5]) + accZ2;

    db("newX pretemps", newX);
    if (time < 500) {
      var acs = newX2 * newX2 + newY2 * newY2 + newZ2 * newZ2;
      if (acs > speedLimit) {
        newX2 = newX2 * .15;
        newY2 = newY2 * .15;
        newZ2 = newZ2 * .15;
      }

      var acs2 = newX * newX + newY * newY + newZ * newZ;
      if (acs2 > speedLimit) {
        newX = newX * .15;
        newY = newY * .15;
        newZ = newZ * .15;
      }
    }

    db("newX final", newX);
    return [newX, newY, newZ, newX2, newY2, newZ2];
  };

var initPos = [[0,0,0]];
var initVel = [[1,1,1,2,2,2]];

initPos.shape = [initPos.length];
initVel.shape = [initVel.length];

print("init  pre: "+JSON.stringify({pos:initPos, vel:initVel}));


try {
  var testPar = testVelocityPar(0, initVel, initPos);
  var testSeq = testVelocitySeq(0, initVel, initPos);
  assertStructuralEq(testSeq, testPar);
} catch (e) {
  print("init post: "+JSON.stringify({pos:initPos, vel:initVel}));
  print("seq: "+JSON.stringify(testSeq));
  print("par: "+JSON.stringify(testPar));

  print(e.name);
  print(e.message);
  print(e.stack);
  throw e;
}

// Using 4000 bodies going off Rick's comment as 4000 being a typical workload.
const NUMBODIES = 300;
const TICKS = 10000;

try {
  Math.seedrandom("seed"); emulateNBody("par", NUMBODIES, TICKS);
} catch (e) {
  print(e.name);
  print(e.message);
  print(e.stack);
  throw e;
}

try {
benchmark("NBODY", 1, 1, // DEFAULT_MEASURE,
          function () { Math.seedrandom("seed"); return emulateNBody("seq", NUMBODIES, TICKS); },
          function () { Math.seedrandom("seed"); return emulateNBody("par", NUMBODIES, TICKS); });
} catch (e) {
  print(e.name);
  print(e.message);
  print(e.stack);
  throw e;
}